#!/bin/bash
if [ -f "/etc/profile.d/modules.sh" ]; then
	. /etc/profile.d/modules.sh	
	module load java/gda
else
	echo "cannot source /etc/profile.d/modules.sh"	
	exit 1
fi

`dirname $0`/gda_command nameserver --stop $@
`dirname $0`/gda_command logserver --stop $@
`dirname $0`/gda_command eventserver --stop $@
`dirname $0`/gda_command objectserver --stop $@

`dirname $0`/gda_command nameserver $@
`dirname $0`/gda_command logserver $@
`dirname $0`/gda_command eventserver $@

if [ -n "$JAVA_OPTS" ] ; then
	export JAVA_OPTS="-Xms128m -Xmx2048m -XX:MaxPermSize=256m -XX:+DisableExplicitGC -XX:ErrorFile=/tmp/hs_err_pid%p.log -XX:-HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/tmp/gdaobjectserver.hprof $JAVA_OPTS"
else
	export JAVA_OPTS="-Xms128m -Xmx2048m -XX:MaxPermSize=256m -XX:+DisableExplicitGC -XX:ErrorFile=/tmp/hs_err_pid%p.log -XX:-HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/tmp/gdaobjectserver.hprof"
fi

`dirname $0`/gda_command objectserver  --smart --trace --debug -p 8001 --restart -v --mode=live $@
